template(name='delta')
    .ui.stackable.padded.grid
        .row
            .eight.wide.right.aligned.column.scrolling
                .ui.inline.header
                    | #{title}
                unless is_loading
                    if currentUser
                        .ui.icon.compact.button.add_model_doc(title="Add #{title}")
                            i.plus.icon
                    //- if can_edit
                        //- +edit_circular.button
        
                    if is_dev
                        //- +user_list_toggle key='bookmark_ids' icon='bookmark' label='Bookmark' color='red'
                        .ui.icon.large.button.edit_model
                            i.large.cog.icon
                            //- | Configure #{plural}
                    // .ui.divider
                    // // each sessions
                    // //     .ui.icon.button.select_session(class=session_selector_class title='select session')
                    // //         i.play.icon
                    if current_delta
                        if is_dev
                            .ui.icon.large.button.print_delta(title='print session doc')
                                i.code.icon
                        .ui.reset.icon.compact.button(title='reload session')
                            i.refresh.icon
                        .ui.delete_delta.icon.button(title='delete session')
                            i.trash.icon
                    else
                        .create_delta.ui.large.button(title='new session')
                            i.plus.icon
                            |session
                    if description
                        .ui.segment
                            |#{description}
                    //- if is_dev
                    //-     .ui.input
                    //-         input.import_subreddit(type='text' placeholder='import_subreddit')
                // |did: #{session_delta_id}
                div
                each sorted_facets
                    +facet
            .eight.wide.column.scrolling
                //- .ui.inline.header
                //-     |sort by
                //- .ui.button
                //- .ui.stackable.four.column.grid
                each current_delta.result_ids
                    //- .column
                    +delta_result
            


template(name='facet')
    if filtering_res
        .ui.icon.small.transparent.input
            i.search.icon
            input.add_filter(type='text')
        each filtering_res
            if name
                .selector.ui.compact.button.toggle_selection(class=toggle_value_class)
                    strong #{name}
                    if is_admin
                        small #{cal_count} #{count}
            else
                .selector.ui.button.toggle_selection(class=toggle_value_class)
                    strong [null]
                    //- small #{cal_count}
        .ui.hidden.divider


template(name='delta_result')
    with result 
        .content
            if youtube_id
                .ui.embed(data-source="youtube" data-id=youtube_id)

            if youtube
                .ui.embed(data-source="youtube" data-id=youtube)

            a.ui.header(href=url) #{url}
            //- each tags
            //-     .ui.label #{this}
            |!{content} !{new_html} !{body} !{description}

            .extra
                if can_edit
                    a.ui.large.icon.button(href="/m/#{current_model.slug}/#{_id}/edit" title='edit')
                        i.pencil.blue.large.icon
                        //- |edit
                a.ui.icon.large.button(href="/m/#{current_model.slug}/#{_id}/view" title='view')
                    i.right.chevron.yellow.large.icon
                .ui.header #{_author_username} #{when}
            if is_author
                +remove_button
        
                
