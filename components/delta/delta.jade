template(name='delta')
    //- with current_model
    .ui.stackable.padded.grid
        .row
            .sixteen.wide.column
                +nav
                unless is_loading
                    if currentUser
                        .ui.icon.large.circular.button.add_model_doc(title="Add #{title}")
                            i.plus.large.icon
                    if current_delta
                        if is_dev
                            .ui.icon.large.circular.button.print_delta(title='print session doc')
                                i.code.icon
                        .ui.reset.icon.circular.button(title='reload session')
                            i.refresh.icon
                        if is_admin
                            .ui.delete_delta.icon.circular.button(title='delete session')
                                i.trash.icon
                    else
                        .create_delta.ui.large.circular.button(title='new session')
                            i.plus.icon
                            |session
                each sorted_facets
                    +facet
        .row
            .sixteen.wide.column
                if single_doc
                    each current_delta.result_ids
                        +delta_result
            


template(name='facet')
    each filters
        .ui.active.large.button.remove_facet_filter #{this}
    if filtering_res
        //- .ui.hidden.divider
        //- .ui.accordion
        //-     .active.title
        //- .ui.grey.inline.header 
            //- if icon
            //-     //- i.small.icon(class=icon)
            //-     +i name=icon classes='ui mini inline image'   
            //- if title
            //-     |#{title}
            //- else 
            //-     |#{key}
                //- i.dropdown.icon
            //- .active.content
        .ui.icon.small.transparent.input
            i.search.icon
            input.add_filter(type='text')
        //- //- div
        each filtering_res
            if name
                .selector.ui.circular.large.button.toggle_selection(class=toggle_value_class)
                    strong #{name}
                    if is_admin
                        small #{cal_count} #{count}
            else
                .selector.ui.compact.button.toggle_selection(class=toggle_value_class)
                    strong [null]
                    //- small #{cal_count}
        //- .ui.hidden.divider

template(name='toggle_delta_config')
    if boolean_true
        .ui.grey.active.icon.button.disable_key(title=label)
            i.icon(class=icon)
            // | #{label}
    else
        .ui.icon.button.enable_key(title=label)
            i.icon(class=icon)
            // | #{label}



template(name='delta_result')
    with result 
        //- if template_exists
        //- else
        //- .ui.result.cloud.fluid.card(class=loading_class)
        .ui.result.stackable.grid.fluid(class=loading_class)
            //- if image_id
            //-     .four.wide.column
            //-         img.ui.image(src="{{c.url image_id width=400 height=400 gravity='face' crop='fill'}}")
            .sixteen.wide.column
                .content
                    each _keys
                        +key_view_template

                    //- +array_view key='_keys' direct=true
                    //- .ui.header model: #{model}
                    //- if description
                    //-     +html_view key='description' direct=true
                    //- if content
                    //-     +html_view key='content' direct=true
                    //- if image_id
                    //-     +image_view key='image' direct=true
                    +detect
                    //- each fields
                    //-     +Template.dynamic template=view_template 
                    .extra
                        +remove_button
                        if is_model
                            +user_list_toggle key='bookmark_ids' icon='bookmark' label='Bookmark' color='red'
                            a.ui.circular.button.route_model(href="/m/#{slug}")
                                i.sitemap.icon
                                |view model
                            if is_admin
                                a.ui.circular.button.route_model(href="/edit/#{_id}")
                                    i.edit.icon
                                    |edit model
                        else
                            if is_admin
                                a.ui.large.icon.circular.button(href="/edit/#{_id}" title='edit')
                                    i.pencil.large.icon
                                    |edit
                            a.ui.icon.huge.circular.button(href="/view/#{_id}" title='view')
                                i.right.chevron.large.icon
                                //- |view
                        //- if _author_id
                        //-     +author_info
                        +creation_info
                        +voting
                        //- .ui.inline.header 
                        //-     +i name='merge'
                        //-     |top matches
                        .ui.icon.circular.button.calculate
                            i.refresh.icon
                        each sorted_matches
                            +doc_match

                            
                    

template(name='user_card_template')
    .ui.result.stackable.grid.segment(class=loading_class)
        if image_id
            .four.wide.column
                img.ui.rounded.image(src="{{c.url image_id width=400 height=400 gravity='face' crop='fill'}}")
        else
            .four.wide.column
                i.massive.user.grey.icon
        .twelve.wide.column
            .content
                .ui.header #{first_name} #{last_name}
                .extra
                    a.ui.icon.large.button(href="/user/#{username}" title='view')
                        i.right.chevron.large.icon
                    each tags
                        .ui.label #{this}
            
            
template(name='model_card_template')
    .ui.result.stackable.grid.segment(class=loading_class)
        a.four.wide.column.route_model(href="/m/#{slug}")
            +i name=icon
        .twelve.wide.column
            .content
                .ui.header #{title}
                .extra
                    each tags
                        .ui.label #{this}
                    +user_list_toggle key='bookmark_ids' icon='bookmark' label='Bookmark' color='red'
                    a.ui.big.icon.button.route_model(href="/m/#{slug}")
                        i.right.chevron.big.icon
