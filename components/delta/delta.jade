template(name='delta')
    with current_model
        .ui.stackable.grid
            .row
                .six.wide.column
                    if icon
                        i.large.grey.icon(class=icon)
                    .ui.inline.header
                        | #{title}
                    unless is_loading
                        if currentUser
                            .add_model_doc.ui.large.icon.button(title="add #{title}")
                                i.plus.large.icon
                        //- if can_edit
                            //- +edit_circular.button
                        if is_dev
                            //- +user_list_toggle key='bookmark_ids' icon='bookmark' label='Bookmark' color='red'
                            .edit_model.ui.compact.large.icon.button
                                i.cog.icon
                        .print_delta.ui.compact.large.icon.button(title='print session doc')
                            i.code.large.icon
                        if current_delta
                            .reset.ui.compact.large.icon.button(title='reload session')
                                i.refresh.icon
                            .delete_delta.ui.compact.large.icon.button(title='delete session')
                                i.trash.icon
                        unless current_delta
                            .create_delta.ui.large.button(title='new session')
                                i.plus.large.icon
                                |session
                        if description
                            .ui.segment
                                |#{description}
                        //- if is_dev
                        //-     .ui.input
                        //-         input.import_subreddit(type='text' placeholder='import_subreddit')
                    // |did: #{session_delta_id}
                    div
                    each sorted_facets
                        +facet
                .ten.wide.column
                    .ui.inline.header
                        |sort by
                    .ui.left.icon.input
                        i.search.icon
                        input.title_filter(type='text' placeholder='filter...' autofocus='autofocus')
                    .ui.items
                        each current_delta.result_ids
                            //- .column
                            +delta_result
                


template(name='facet')
    if filtering_res
        //- .ui.hidden.divider
        //- .ui.accordion
        //-     .active.title
        if icon
            i.grey.icon(class=icon)
            //- +i name=icon classes='ui avatar image pointer inline'   
        .ui.inline.header 
            if title
                |#{title}
            else 
                |#{key}
                //- i.dropdown.icon
        .ui.icon.small.transparent.input
            i.search.icon
            input.add_filter(type='text')
            //- .active.content
                //- div
        //- each filters
        //-     .selector.ui.large.active.compact.button.toggle_selection(class=toggle_value_class)
        //-         strong #{this}
        //-         if is_admin
        //-             small #{name}
        each filtering_res
            if name
                .selector.ui.large.compact.button.toggle_selection(class=toggle_value_class)
                    strong #{name}
                    if is_admin
                        small #{cal_count} #{count}
            else
                .selector.ui.button.toggle_selection(class=toggle_value_class)
                    strong [null]
                    //- small #{cal_count}
        .ui.hidden.divider

template(name='toggle_delta_config')
    if boolean_true
        .ui.active.icon.button.disable_key(title=label)
            i.icon(class=icon)
            // | #{label}
    else
        .ui.icon.button.enable_key(title=label)
            i.icon(class=icon)
            // | #{label}



template(name='delta_result')
    with result 
        if template_exists
            +Template.dynamic template=model_template
        else
            //- .ui.result.cloud.fluid.item(class=loading_class)
            .ui.item(class=loading_class)
                if poster_image
                    .image
                        img.ui.rounded.image(src="{{c.url poster_image width=400 height=400 gravity='face' crop='fill'}}")
                        //- +image_view key='poster_image' direct=true
                .content
                    .header #{title}
                    .description
                        //- if image
                        //-     +image_view key='image' direct=true
                        //- .ui.fluid.styled.accordion
                        each fields
                            +Template.dynamic template=view_template 
                                //- .title
                                //-     |#{title}
                                //-     i.grey.dropdown.icon
                                //- .content.smallscroll
                    //- each actions
                    //-     +Template.dynamic template=this data=current_doc
                    .extra
                        if is_model
                            //- +user_list_toggle key='bookmark_ids' icon='bookmark' label='bookmark' color='red'
                            a.ui.button.route_model(href="/m/#{slug}")
                                i.sitemap.icon
                                |view model
                            if is_admin
                                a.ui.button.route_model(href="/model/edit/#{_id}")
                                    i.edit.blue.icon
                                    |edit model
                        if can_edit
                            a.ui.icon.big.button(href="/m/#{current_model.slug}/#{_id}/edit" title='edit')
                                i.pencil.large.icon
                        a.ui.icon.big.button(href="/m/#{current_model.slug}/#{_id}/view" title='view')
                            i.chevron.right.large.icon
                        if _author_id
                            +author_info
                        +creation_info
                    //- if is_dev
                    //-     +text_edit key='model' direct=true
                    //-     .ui.inline.header _id: #{_id}
                    //-     .ui.inline.header light fields
                    //-     each _keys
                    //-         .ui.label #{this}
                    //-     .ui.inline.header fields
                    //-     each _fields
                    //-         .ui.label #{this}
                    //-     //- +call_method name='detect_fields'
                    //-     //- +call_method name='key' icon='key'
                    //-     +remove_button
                    //-     +clone
                    
